<h1 align="center">Welcome to statndup-bot üëã</h1>
<p>
  <img alt="Version" src="https://img.shields.io/badge/version-1.0.0-blue.svg?cacheSeconds=2592000" />
  <a href="#" target="_blank">
    <img alt="License: ISC" src="https://img.shields.io/badge/License-ISC-yellow.svg" />
  </a>
</p>

> A Slack bot to post daily standup status. It launches a modal, prompting users for Yesterday, Today, Parking Lot Items, Parking Lot Participants, and Pull Requests for Review.
> Users can schedule standup for a specific time, or post it immediately. They can edit their standup messages on the App's Home Tab.

### Standup Modal
![Standup Modal](img/modal.png)

### Home Tab
![Home Tab](img/home_screen.png)

## Install
Add bot to channels where you wish to use it.

![Slack Integration](img/slack_integration.png)

Or invite the bot to the channel with `@Standup`.

## Usage - Slack
```sh
/standup help
/standup [parking-lot | parking_lot | parkinglot | -p]- display ephemeral parking lot items
/standup post [parking-lot | parking_lot | parkinglot | -p] - post parking lot items to chat
```

## Deployment
[SLS](https://www.serverless.com/) makes it easy to deploy to AWS

Install with the command

```
npm install -g serverless
```

```
sls deploy --stage (prod | dev) [--aws-profile profile-name] [--region us-east-2]
```

To inspect the size and content of the deployment without deploying anything to AWS
```
sls package --stage (prod | dev) [--aws-profile profile-name]
```

You can also check configuration substitutions. This is useful for checking things like the target `region`.
```
sls print --stage (prod | dev)
```

### Secrets
Create a secret in SecretsManager named `SlackStandup-secret-dev` or `SlackStandup-secret-prod`, depending on the target environment, with the values

* `SLACK_STANDUP_BOT_TOKEN`
* `SLACK_STANDUP_SIGNING_SECRET`

These can be found on the Slack website. Copy-paste the following values.

#### SLACK_STANDUP_BOT_TOKEN
In the app's _OAuth & Permissions_:

![Oauth](img/oauth.png)

#### SLACK_STANDUP_SIGNING_SECRET
In the app's _Basic Settings_ copy the value for _Signing Secret_:

![Signing secret](img/signing_secret.png)

## Local Development
Testing locally requires Docker, and setting the following environment variables in a `.env` file. These are the same values found in the **Secrets** section of this document.

* `SLACK_STANDUP_TOKEN`
* `SLACK_STANDUP_SIGNING_SECRET`

Deploy to Docker with the following command:
```sh
npm run serverless-localstack
```
This retrieves the local environment variables and creates secrets and a DynamoDB table in the Localstack instance.

Localstack runs on port `4566`.

### Script Permissions
Localstack is loaded with scripts in `src/test/scripts`. These may need updated permissions to execute.

```sh
chmod 755 src/test/scripts/*
```

### Slack -> Locally running Lambda
To connect Slack to this running instance, start `ngrok` with either of these commands. This assumes `ngrok` is installed in the user's home directory.

```sh
npm run ngrok

~/ngrok http 5000
```

This will create a URL to enter into Slack's _Slash Command_ interface for this app.

### Querying DynamoDB
The `context.ts` file sets up some fake credentials, and we need these to query the DynamoDB instance using the [aws cli](https://awscli.amazonaws.com/v2/documentation/api/latest/reference/dynamodb/index.html#cli-aws-dynamodb).

This command will scan the local DynamoDB instance for all items the table `local_STANDUP_STATUS`.
```
AWS_ACCESS_KEY_ID=not-a-real-access-key-id AWS_SECRET_ACCESS_KEY=not-a-real-access-key aws dynamodb scan --table-name local_STANDUP_STATUS  --endpoint-url http://localhost:4566
```

## Slack Configuration

This bot uses a **Slash Command** and enabled **Interactivity**.
![Slash Commands](img/slashcommand.png)

_Note: this slash command is connected to the lambda function in `app.ts`_
```
app.command("/standup",...
```

![Interactivity](img/interactivity.png)
* Slash Commands and Interactivity use the same Request URL, which ends in `/slack/events`
* For local testing, set these to the URL generated by `ngrok`
* When the app is live, set these to the lambda URL

The app needs permissions to interact with the Slack workspace. Enable OAuth scopes in Slack.

![Slack Scopes](img/slack_scopes.png)

* `chat:write`
* `chat:write.customize`
* `commands`
* `groups:read`
* `users.profile:read`
* `users:read`
* `channels:read`

This bot also has a **Home Tab**, which must be enabled in _App Home_.

![Home Tab](img/home_tab.png)

## 
## Author

üë§ **Steve Thompson**


## Show your support

Give a ‚≠êÔ∏è if this project helped you!

***
_This README was generated with ‚ù§Ô∏è by [readme-md-generator](https://github.com/kefranabg/readme-md-generator)_